# CIDR 計算與切割完全指南

本文件專注於：

-   CIDR 是什麼
-   如何計算可用 IP 數量
-   如何切割子網（Subnetting）
-   常見實戰範例

------------------------------------------------------------------------

## 一、CIDR 是什麼？

CIDR（Classless Inter-Domain Routing）用來描述一段 IP 範圍，例如：

``` text
10.0.0.0/24
```

含意：

-   `10.0.0.0`：網段起始位址
-   `/24`：前 24 個 bits 固定為「網路位址」
-   剩下 `32 - 24 = 8 bits` 為主機位址

可用 IP 數量：

``` text
2^(32 - 24) = 256
```

通用公式：

> 可用 IP 數量 = `2^(32 - prefix)`

  CIDR   可用 IP 數
  ------ ------------
  /16    65,536
  /20    4,096
  /24    256
  /26    64
  /28    16

------------------------------------------------------------------------

## 二、如何切割子網（Subnetting）

假設原始網段為：

``` text
10.0.0.0/24   （256 個 IP）
```

### 範例 1：切成 2 段

-   256 ÷ 2 = 128
-   128 = 2\^7 → 新 prefix = 32 - 7 = `/25`

結果：

``` text
10.0.0.0/25     (0   - 127)
10.0.0.128/25   (128 - 255)
```

------------------------------------------------------------------------

### 範例 2：切成 4 段

-   256 ÷ 4 = 64
-   64 = 2\^6 → 新 prefix = 32 - 6 = `/26`

結果：

``` text
10.0.0.0/26     (0   - 63)
10.0.0.64/26    (64  - 127)
10.0.0.128/26   (128 - 191)
10.0.0.192/26   (192 - 255)
```

------------------------------------------------------------------------

### 範例 3：切成 8 段

-   256 ÷ 8 = 32
-   32 = 2\^5 → 新 prefix = 32 - 5 = `/27`

結果：

``` text
10.0.0.0/27     (0   - 31)
10.0.0.32/27    (32  - 63)
10.0.0.64/27    (64  - 95)
...
```

```
/24 往下切：
	•	/25 → 2 段
	•	/26 → 4 段
	•	/27 → 8 段
       .
       .
       .
```
------------------------------------------------------------------------

## 三、快速心法

1.  原始可用 IP = `2^(32 - 原 prefix)`
2.  每段大小 = `原始 IP ÷ 份數`
3.  找到「最接近的 2 次方」
4.  新 prefix = `32 - log2(每段大小)`
5.  每一段以「每段大小」為間距遞增

記憶公式：

> 子網數量 = `2^(新 prefix - 原 prefix)`

例：

``` text
/24 → /26
2^(26 - 24) = 4 段
```

------------------------------------------------------------------------

## 四、AWS 實務對應

  用途                       常見 CIDR
  -------------------------- -----------
  VPC                        /16
  Subnet（Public/Private）   /24
  小型測試子網               /26, /28

掌握 CIDR 切割，你就能：

-   自由規劃 VPC 與 Subnet
-   正確配置多 AZ 架構
-   在面試時清楚說明網路設計邏輯
